<link rel="import" href="../polymer/polymer.html">
<!--
A Polymer custom element for displaying elapsed time.

@element elapsed-time
@homepage https://github.com/miztroh/elapsed-time
-->
<polymer-element name="elapsed-time">
	<template>
		<span id="elapsedTime"></span>
	</template>
	<script>
		Polymer(
			{
				dateChanged: function () {
					if (isNaN(new Date(this.date))) {
						this.date = new Date();
					}
				},
				publish: {
					/**
	        * The date from which elapsed time is calculated.
	        *
	        * @property date
	        * @type string
	        * @default Today's date in the format YYYY-MM-DD HH:MM:SS
	        */
					date: {
						value: (
							function () {
								var date = new Date();
								return date.getFullYear() + '-' + (date.getMonth() + 1 < 10 ? '0' : '') + (date.getMonth() + 1) + '-' + (date.getDate() < 10 ? '0' : '') + date.getDate() + ' ' + (date.getHours() < 10 ? '0' : '') + date.getHours() + ':' + (date.getMinutes < 10 ? '0' : '') + date.getMinutes() + ':' + (date.getSeconds() < 10 ? '0' : '') + date.getSeconds();
							}
						)(),
						reflect: true
					},
					/**
	        * Whether to show elapsed time when less than 60 seconds.
	        *
	        * @property showSeconds
	        * @type boolean
	        * @default false
	        */
					showSeconds: false
				},
				ready: function () {
					var that = this;

					var elapsedTime = function () {
						var date = new Date(that.date);

						if (isNaN(date)) {
							return that.$.elapsedTime.text = '';
						}

				    var ageInSeconds = parseInt((new Date().getTime() - date.getTime()) / 1000);

				    var s = function (n) {
				    	return n === 1 ? '' : 's'
				    };

						var elapsedTime;
						var now_or_ago = ' ago';

						if (ageInSeconds < 0) {
							now_or_ago = ' from now';
							ageInSeconds = Math.abs(ageInSeconds);
						}

				    if (ageInSeconds < 60) {
				    	if (that.showSeconds) {
								var n = ageInSeconds;
								elapsedTime = n + ' second' + s(n) + now_or_ago;
				    	} else {
					      elapsedTime = 'just now';
				    	}
				    } else if (ageInSeconds < 60 * 60) {
							var n = Math.floor(ageInSeconds / 60);
							elapsedTime = n + ' minute' + s(n) + now_or_ago;
				    } else if (ageInSeconds < 60 * 60 * 24) {
							var n = Math.floor(ageInSeconds / 60 / 60);
							elapsedTime = n + ' hour' + s(n) + now_or_ago;
				    } else if (ageInSeconds < 60 * 60 * 24 * 7) {
							var n = Math.floor(ageInSeconds / 60 / 60 / 24);
							elapsedTime = n + ' day' + s(n) + now_or_ago;
				    } else if (ageInSeconds < 60 * 60 * 24 * 31) {
							var n = Math.floor(ageInSeconds / 60 / 60 / 24 / 7);
							elapsedTime = n + ' week' + s(n) + now_or_ago;
				    } else if (ageInSeconds < 60 * 60 * 24 * 365) {
							var n = Math.floor(ageInSeconds / 60 / 60 / 24 / 31);
							elapsedTime = n + ' month' + s(n) + now_or_ago;
				    } else {
							var n = Math.floor(ageInSeconds / 60 / 60 / 24 / 365);
							elapsedTime = n + ' year' + s(n) + now_or_ago;
				    }

						that.$.elapsedTime.innerHTML = elapsedTime;
					};

					elapsedTime();

					setInterval(
						elapsedTime,
						1000
					);
				}
			}
		);
	</script>
</polymer-element>